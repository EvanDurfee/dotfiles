#!/bin/bash

{{ range (glob (joinPath .chezmoi.sourceDir "dconf/*")) -}}
{{ if eq (stat .).type "file" -}}
    # {{ . }} hash: {{ includeTemplate . | sha256sum }}
{{ end -}}
{{ end }}
cat <<'EOF'
===================================================
Load dconf settings
===================================================
EOF

# Ensure profile is configured when running on a fresh system
if [ -z "${DOTFILES_PROFILE_LOADED:-}" ]; then . ~/.bash_profile; fi

while IFS= read -r f; do
	dconf_path=/"$(basename "$f" | sed 's|\.|/|g')"/
	echo "Loading $dconf_path from $f"
	dconf load "$dconf_path" < "$f"
done < <(find {{ joinPath .chezmoi.sourceDir "dconf" | quote }} -mindepth 1 -maxdepth 1 -name "*" -type f)
