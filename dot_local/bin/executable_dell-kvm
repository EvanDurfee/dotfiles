#!/usr/bin/env bash

# https://jeancharles.quillet.org/posts/2021-08-20-How-to-use-ddcutil-to-switch-input-of-a-Dell-screen.html

set -euo pipefail

# Run `ddcutil capabilities` to see all supported properties

# Get current input
# disabled - pretty slow on the laptop
# current="$(ddcutil getvcp 60 | sed -n "s/.*(sl=\(.*\))/\1/p")"

# See https://www.dmtf.org/standards/SMBIOS
chassis="$(cat /sys/class/dmi/id/chassis_type)"
case "$chassis" in
	# Probably a desktop
	3 | 4 | 5 | 6 | 7 | 35)
		current='desktop'
		;;
	*)
		current='laptop'
		;;
esac

# Get the other input
case "$current" in

    # Usb
    laptop | 0x19)
        output=0x0f
        ;;

    # Display port
    desktop | 0x0f)
        output=0x19
        ;;

    # HDMI
    0x11)
        output=0x19
        ;;

    *)
        echo "Unknown input"
        exit 1
        ;;
esac

# Set new input
ddcutil setvcp 60 "$output"
